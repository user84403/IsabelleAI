<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Isabelle AI</title>

  <style>
    :root{
      --accent:#FD2B2B;
      --bg:#070A0F;
      --panel:#0B1020;
      --border:#1B2440;
      --text:#E9EEFF;
      --muted:#A7B0D6;
      --bubble:#0E1428;
      --bubbleUser:#1A1020;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg);
      color:var(--text);
      display:flex;
      justify-content:center;
      padding:24px;
    }

    .app{
      width:100%;
      max-width:900px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    header{
      display:flex;
      align-items:center;
      gap:14px;
    }

    .avatar{
      width:44px;
      height:44px;
      border-radius:50%;
      overflow:hidden;
      border:1px solid var(--border);
      flex:0 0 auto;
    }

    .avatar img{
      width:100%;
      height:100%;
      object-fit:cover;
      object-position:center 18%;
    }

    h1{
      margin:0;
      font-size:20px;
      font-weight:700;
    }

    .sub{
      font-size:13px;
      color:var(--muted);
    }

    .panel{
      flex:1;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    .messages{
      flex:1;
      padding:16px;
      overflow:auto;
    }

    .msg{
      display:flex;
      gap:10px;
      margin-bottom:14px;
    }

    .msg.user{
      flex-direction:row-reverse;
    }

    .msg .bubble{
      background:var(--bubble);
      border:1px solid var(--border);
      padding:12px 14px;
      border-radius:14px;
      max-width:70%;
      white-space:pre-wrap;
      line-height:1.35;
    }

    .msg.user .bubble{
      background:var(--bubbleUser);
      border-color:#3a1830;
    }

    .composer{
      display:flex;
      gap:10px;
      padding:14px;
      border-top:1px solid var(--border);
    }

    textarea{
      flex:1;
      resize:none;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#050914;
      color:var(--text);
      font-size:14px;
    }

    button{
      padding:12px 16px;
      border-radius:12px;
      border:0;
      background:var(--accent);
      color:white;
      font-weight:700;
      cursor:pointer;
    }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
  </style>
</head>

<body>
  <div class="app">

    <header>
      <div class="avatar">
        <img src="./isabelle.png" alt="Isabelle">
      </div>
      <div>
        <h1>Isabelle AI</h1>
        <div class="sub">Ask anything about the program</div>
      </div>
    </header>

    <div class="panel">
      <div class="messages" id="messages"></div>

      <div class="composer">
        <textarea id="input" placeholder="Type your question..."></textarea>
        <button id="send">Send</button>
      </div>
    </div>

  </div>

  <script>
    const CHAT_ENDPOINT = "https://mzccaacasiuvixvhscrt.supabase.co/functions/v1/chat";

    const messagesEl = document.getElementById("messages");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("send");

    function addMessage(role, text){
      const row = document.createElement("div");
      row.className = "msg" + (role === "user" ? " user" : "");

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;

      row.appendChild(bubble);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function send(){
      const text = inputEl.value.trim();
      if(!text) return;

      inputEl.value = "";
      addMessage("user", text);

      sendBtn.disabled = true;

      try{
        const res = await fetch(CHAT_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify({ message: text })
        });

        if(!res.ok){
          const err = await res.text();
          addMessage("assistant", "Server error:\n" + err);
          return;
        }

        const data = await res.json();
        addMessage("assistant", data.reply || "No reply");
      }catch(e){
        addMessage("assistant", "Network error calling AI");
      }finally{
        sendBtn.disabled = false;
      }
    }

    sendBtn.onclick = send;
    inputEl.addEventListener("keydown", e => {
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        send();
      }
    });

    // initial message
    addMessage(
      "assistant",
      "Hi, I’m Isabelle AI.\nAsk me anything about the program and I’ll answer based on the course materials you have access to."
    );
  </script>
</body>
</html>



